<!DOCTYPE html>
<html lang="en">
   <head>
       <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<title>วิธีทำแอพแชทง่ายๆ ด้วย Ionic2 &#9642; Noob Studio</title>
<!--
<meta name="description" content="มาทำแอพแชทแบบง่ายๆ ไว้คุยมุ้งมิ้งกับแฟนด้วย Ionic 2 กับ Node.Js กันเถอะ เบื่อไหมครับที่เวลาจะเขียนแอพขึ้นมาซักแอพหนึ่งเนี่ยต้องนั่งทำทั้ง Android iOS ไหนจะต้องเรียนรู้ภาษาใหม่ๆ ทั้ง Java Swift โหยลำบากวุ่นวายอ่ะ แล้วทำไมกูต้องไปเรียนรู้ภาษาใหม่ๆด้วยว่ะครับ ทั้งๆ ที่กูก็เขียบเว็ปเป็นอยู่แล้วทำไมจะเอาพวก Javascript CSS HTML มาทำแอพไม่ได้!! แต่ช้าก่อนนี่มันโลกยุค 2017 แล้วนะจ๊ะ TV Direct ขอนำเสนอ{:.message}
">
-->
<meta name="description" content="มาทำแอพแชทแบบง่ายๆ ไว้คุยมุ้งมิ้งกับแฟนด้วย Ionic 2 กับ Node.Js กันเถอะ เบื่อไหมครับที่เวลาจะเขียนแอพขึ้นมาซักแอพหนึ่งเนี่ยต้องนั่งทำทั้ง Android iOS ไหนจะต้...">
<meta name="keywords" content="node.js, ionic framework, Typescript, javascript, firebase, Angular, socket.io">
<link rel="canonical" href="http://localhost:4000/posts/ionic-chat">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="วิธีทำแอพแชทง่ายๆ ด้วย Ionic2" />
<meta name="twitter:description" content="มาทำแอพแชทแบบง่ายๆ ไว้คุยมุ้งมิ้งกับแฟนด้วย Ionic 2 กับ Node.Js กันเถอะ เบื่อไหมครับที่เวลาจะเขียนแอพขึ้นมาซักแอพหนึ่งเนี่ยต้องนั่งทำทั้ง Android iOS ไหนจะต้องเรียนรู้ภาษาใหม่ๆ ทั้ง Java Swift โหยลำบากวุ่นวายอ่ะ แล้วทำไมกูต้องไปเรียนรู้ภาษาใหม่ๆด้วยว่ะครับ ทั้งๆ ที่กูก็เขียบเว็ปเป็นอยู่แล้วทำไมจะเอาพวก Javascript CSS HTML มาทำแอพไม่ได้!! แต่ช้าก่อนนี่มันโลกยุค 2017 แล้วนะจ๊ะ TV Direct ขอนำเสนอ" />
<meta name="twitter:image" content="http://localhost:4000" />
<meta name="author" content="">
<link rel="author" href="">
<meta property="og:locale" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="วิธีทำแอพแชทง่ายๆ ด้วย Ionic2">
<meta property="og:description" content="มาทำแอพแชทแบบง่ายๆ ไว้คุยมุ้งมิ้งกับแฟนด้วย Ionic 2 กับ Node.Js กันเถอะ เบื่อไหมครับที่เวลาจะเขียนแอพขึ้นมาซักแอพหนึ่งเนี่ยต้องนั่งทำทั้ง Android iOS ไหนจะต้องเรียนรู้ภาษาใหม่ๆ ทั้ง Java Swift โหยลำบากวุ่นวายอ่ะ แล้วทำไมกูต้องไปเรียนรู้ภาษาใหม่ๆด้วยว่ะครับ ทั้งๆ ที่กูก็เขียบเว็ปเป็นอยู่แล้วทำไมจะเอาพวก Javascript CSS HTML มาทำแอพไม่ได้!! แต่ช้าก่อนนี่มันโลกยุค 2017 แล้วนะจ๊ะ TV Direct ขอนำเสนอ">
<meta property="og:url" content="http://localhost:4000/posts/ionic-chat">
<meta property="og:site_name" content="Noob Studio">
<link rel="stylesheet" href="/assets/vendor/normalize-css/normalize.css">
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,400italic,700,700italic">
<style>
    html {
      font-family: "Rubik", -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    }
</style>
<link rel="stylesheet" href="/assets/css/bf.css">
   <body>
       <div class="wrapper" id="blep">
          <header>
   <div class="menu">
     <div class="logo">
        <a href="/">Noob Studio</a>
     </div>
       <ul>
           <li><a href="/about">about</a>
           <li><a href="/archive">archive</a>
           <li><a href="/noob-engine">noob engine</a>
       </ul>
   </div>
   <div class="social">
     <ul>
       <li>
            <a href="https://github.com/noob-studio" target="_blank" class="smaller">
              <span class="icon-github"></span>
            </a>
       <li>
            <a href="mailto:noob.studio101@gmail.com" target="_blank">
              <span class="icon-mail_outline"></span>
            </a>
       <li>
            <a href="/feed.xml" target="_blank">
                <span class="icon-rss_feed"></span>
            </a>
       <li>
            <a href="#" onclick="switchTheme()" title="Switch theme?">
              <span class="icon-invert_colors" id="theme-switcher"></span>
            </a>
     </ul>
   </div>
</header>
<article class="post">
<style>
  .ionic-chat {
    margin-bottom: 2em;
  }
  .ionic-chat::before {
    background-image: url('/img/ionic-chat/cover.jpg');
    background-size: cover;
    /* -webkit-filter: grayscale(1) brightness(0.5) contrast(0.5); */
    content:'';
    position:absolute;
    width: 100%;
    left: 0;
    top: 0;
    z-index: -2;
  }
  .ionic-chat::after {
    content:'';
    position:absolute;
    width: 100%;
    left: 0;
    top: 0;
    background-color: rgba(0,0,0,.4);
    /*mix-blend-mode: darken;
    mix-blend-mode: color-burn;
    mix-blend-mode: hard-light;*/
    mix-blend-mode: darken;
    z-index: -1;
  }
  .ionic-chat-container,
  .ionic-chat-container::before,
  .ionic-chat-container::after {
    height: 25rem;
  }
  .ionic-chat-bleed-container,
  .ionic-chat-bleed-container::before,
  .ionic-chat-bleed-container::after {
    height: 35rem;
  }
    @media (max-width: 48rem) {
        .ionic-chat-container,
        .ionic-chat-container::before,
        .ionic-chat-container::after{
            height: 20rem;
            margin-bottom: 3rem;
        }
    }
</style>
 <div class="post-title-container
  ionic-chat ionic-chat-bleed-container bleed-hero-container
    ">
    <!--Post hero image source-->
   <div class="heading-container hero-heading hero-heading-post">
     <h1>
          วิธีทำแอพแชทง่ายๆ ด้วย Ionic2
     </h1>
     <div class="post-meta">
        <span>19/03/2017</span>
        <span>
              <a href="/tag/node.js">#node.js</a>
              <a href="/tag/ionic framework">#ionic framework</a>
              <a href="/tag/Typescript">#Typescript</a>
              <a href="/tag/javascript">#javascript</a>
              <a href="/tag/firebase">#firebase</a>
              <a href="/tag/Angular">#Angular</a>
              <a href="/tag/socket.io">#socket.io</a>
        </span>
     </div>
   </div>
 </div>
   <p class="lead">เบื่อไหมครับที่เวลาจะเขียนแอพขึ้นมาซักแอพหนึ่งเนี่ยต้องนั่งทำทั้ง Android iOS
<p>ไหนจะต้องเรียนรู้ภาษาใหม่ๆ ทั้ง Java Swift โหยลำบากวุ่นวายอ่ะ แล้วทำไมกูต้องไปเรียนรู้ภาษาใหม่ๆด้วยว่ะครับ ทั้งๆ ที่กูก็เขียบเว็ปเป็นอยู่แล้วทำไมจะเอาพวก Javascript CSS HTML มาทำแอพไม่ได้!! แต่ช้าก่อนนี่มันโลกยุค 2017 แล้วนะจ๊ะ TV Direct ขอนำเสนอ <a href="https://ionicframework.com/" target="_blank">Ionic2</a> !
<blockquote>สมัยก่อนการทำแอพขึ้นมาซักแอพนึงเนี่ยต้องทำทั้ง iOS และ Android แต่เดี๋ยวนี้ไม่ต้องแล้ว</blockquote>
<h1 id="what-is-ionic2">What is Ionic2</h1>
<p>Ionic2 คือเครื่องมือที่ทำให้เราสามารถเขียนแอพเพียงครั้งเดียวสามารถทำงานได้ทุก Platform (หรือที่เรียกแบบเกร๋ๆ ว่า Cross Platform) โดยใช้แค่ Javascript CSS HTML ในการเขียนโปรแกรมซึ่งการทำงานของ Ionic2 ก็คือตัว Ionic2 จะทำตัวเป็นเหมือน Browser ที่แสดงเฉพาะเว็ปๆ เดียวก็คือเว็ปที่เราเขียนขึ้นมานั่นเองซึ่งเราจะเรียกแอพที่ทำงานในลักษณะนี้ว่า Hybrid App หลายคนอ่านมาถึงตรงนี้อาจจะคิดว่ามันก็คือเว็ปธรรมดาก็ไม่เหมือนแอพจริงๆ สิ ผมขอบอกตรงนี้นะครับนี่มันโลกยุคไหนแล้วถ้าไม่มีคนบอกผมนั่งยันนอนยันตะแคงข้างยันเลยว่ายังไงก็ดูไม่ออกเอาล่ะโม้มาเยอะแล้วมาเริ่มกันเถอะ
<blockquote>Javascript ที่ Ionic2 ใช้คือ <a href="https://angular.io/" target="_blank">Angular2</a> นะครับ</blockquote>
<h1 id="required--install">Required &amp; Install</h1>
<p>สิ่งที่ต้องการสำหรับใช้งาน
<ul>
   <li>พื้นฐาน Node.js นิดหน่อย (อีกแล้วครับท่าน)
   <li>Node.js เวอร์ชันล่าสุด
   <li>Android Studio เพราะว่าเราต้องการตัว Android SDK นะจ๊ะถ้าใครไม่มีสามารถดาวโหลดได้ <a href="https://developer.android.com/studio/index.html" target="_blank">ที่นี่</a> (จริงๆแล้วดาวโหลดแค่ SDK tool ก็ได้แต่ว่าผมว่าลง Android Studio ไปเลยจะเวิร์คกว่า)
   <li>Geanymotion เป็น emulator ทดสอบแอพของเรานะครับถ้าใครไม่มีสามารถดาวโหลดได้ <a href="https://www.genymotion.com/" target="_blank">ที่นี่</a>
   <li>Ionic2 ติดตั้งสามารถด้วยคำสั่งนี้ 
    ~~~js
    npm install -g cordova ionic
    ~~~ 
   <li>ในบทความนี้จะไม่ลงรายละเอียดถึงตัว Angular2 เยอะนะครับควรจะศึกษามาบ้างเล็กน้อยเพื่อความเข้าใจ
</ul>
<h1 id="start-server">Start Server</h1>
<p>เมื่อเรามีสิ่งที่ต้องหมดแล้วต่อมาก็มาเริ่มกันเถอะ โดยเราจะเริ่มจากทำฝั่ง Server ก่อนนะจ๊ะ
<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="nx">mkdir</span> <span class="nx">ionic</span><span class="o">-</span><span class="nx">chat</span>
    <span class="nx">cd</span> <span class="nx">ionic</span><span class="o">-</span><span class="nx">chat</span>
    <span class="nx">npm</span> <span class="nx">init</span>
    <span class="nx">npm</span> <span class="nx">install</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">io</span> <span class="nx">express</span> <span class="o">--</span><span class="nx">save</span>
</code></pre>
</div>
<p>socket.io สำหรับรับส่งข้อความแบบ real time ส่วน express ใช้เป็น server (จริงๆไม่ต้องใช้ก็ได้แต่ผมขี้เกียจเขียนเองอ่ะมีไรป่ะ) เมื่อทำเสร็จแล้วให้สร้างไฟล์ index.js ขึ้นมาโดยใส่ Code ข้างล่างนี้ลงไป
<b>index.js</b>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">).</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'socket.io'</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">,</span> <span class="s2">"*"</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"Origin, X-Requested-With, Content-Type, Accept"</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span><span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'This is ma awesome server'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connection'</span><span class="p">,</span> <span class="p">(</span><span class="nx">client</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Client connected...'</span><span class="p">);</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'msg'</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'msg'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5555</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Program running on port : 5555'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>
<p>แค่นี้เหลาะครับสำหรับฝั่ง Server ของเราเป็นอันเรียบร้อยอธิบาย Code นะครับ
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">).</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'socket.io'</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</code></pre>
</div>
<p>เรียกใช้และสร้าง server โดยใช้ express และผูก Socket.io ไว้กับ server ที่ถูกสร้างขึ้น
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"Origin, X-Requested-With, Content-Type, Accept"</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre>
</div>
<p>เซ็ท Header ให้เรียกใช้จาก server อื่นได้
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span><span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'This is ma awesome server'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>
<p>เซ็ท route สำหรับคนที่เข้ามาใน server ผ่านทาง browser
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connection'</span><span class="p">,</span> <span class="p">(</span><span class="nx">client</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span>
</code></pre>
</div>
<p>เป็น event ที่จะเกิดขึ้นเมื่อมีผู้ใช้เชื่อมต่อเข้ามาในท่อ
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'msg'</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span>
</code></pre>
</div>
<p>เป็น event ที่จะเกิดขึ้นเมื่อผู้ใช้ส่งข้อมูลเข้ามาผ่านท่อที่ชื่อว่า msg
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'msg'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
</code></pre>
</div>
<p>ส่ง msg ที่ได้รับให้ผู้ใช้ทุกคน
<blockquote>
ถ้าหากต้องการส่งให้ทุกคนยกเว้นตัวคนส่งเองให้ใส่เป็น
~~~js
client.broadcast.emit('msg', message);
~~~
แต่ถ้าต้องการส่งกลับไปให้คนส่งคนเดียวเท่านั้น(แล้วจะเรียกว่า chat ไหมหนอ) ให้ใส่เป็น
~~~js
client.emit('msg', message);
~~~
</blockquote>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5555</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Program running on port : 5555'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>
<p>เริ่มต้นการทำงานของ server ที่ port 5555 ด้วยคำสั่ง<pre>node index.js</pre>
<p>เมื่อทดลองเข้าผ่านหน้าเว็ปไปที่ <a href="http://localhost:5555" target="_blank">http://localhost:5555</a> จะได้หน้าตาดังภาพข้างล่างนี้
<img src="/img/ionic-chat/img01.png" alt="ทดลองรัน server" />
<span class="caption text-muted">ทดลองรัน server ผ่าน Browser</span>
<h1 id="start-ionic2">Start Ionic2</h1>
<p>เอาล่ะครับน่าจะถึงเวลาที่ทุกคนรอคอยได้เขียนแอพจริงๆซักที 5555 เริ่มด้วยคำสั่ง<pre>
ionic start ionic-chat-client blank --v2
cd ionic-chat-client
</pre>
<p>เข้ามาจะเห็นไฟล์อะไรเยอะแยะเลยนะครับไม่ต้องตรงใจในตอนนี้เราสนใจแค่ในโฟรเดอร์ src ก็พอเมื่อเข้ามาจะเห็นว่าโครงสร้างมันคล้ายๆเว็ปไซด์เลยให้เปิดไฟล์ index.html ขึ้นมาหลังจากนั้นให้เพิ่มโหลด script นี้เข้าไป
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>
<p>เข้าไปที่ Page/home/home.html และแก้ไข Code ให้เป็นดังนี้
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ion-header&gt;</span>
  <span class="nt">&lt;ion-navbar&gt;</span>
    <span class="nt">&lt;ion-title&gt;</span>
      Ionic Blank
    <span class="nt">&lt;/ion-title&gt;</span>
  <span class="nt">&lt;/ion-navbar&gt;</span>
<span class="nt">&lt;/ion-header&gt;</span>

<span class="nt">&lt;ion-content</span> <span class="na">padding</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ion-card</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let msg of massage"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ion-card-content&gt;</span>
      {{ msg }}

    <span class="nt">&lt;/ion-card-content&gt;</span>
  <span class="nt">&lt;/ion-card&gt;</span>
<span class="nt">&lt;/ion-content&gt;</span>

<span class="nt">&lt;ion-footer&gt;</span>
  <span class="nt">&lt;ion-toolbar&gt;</span>
    <span class="nt">&lt;ion-item&gt;</span>
      <span class="nt">&lt;ion-label</span> <span class="na">fixed</span><span class="nt">&gt;</span>Massage: <span class="nt">&lt;/ion-label&gt;</span>
      <span class="nt">&lt;ion-input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="err">[(</span><span class="na">ngModel</span><span class="err">)]="</span><span class="na">msg</span><span class="err">"</span><span class="nt">&gt;&lt;/ion-input&gt;</span>
    <span class="nt">&lt;/ion-item&gt;</span>
    <span class="nt">&lt;ion-buttons</span> <span class="na">end</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">send</span><span class="err">()"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">ion-button</span> <span class="na">icon-right</span> <span class="na">color=</span><span class="s">"royal"</span><span class="nt">&gt;</span>
        Send
        <span class="nt">&lt;ion-icon</span> <span class="na">name=</span><span class="s">"send"</span><span class="nt">&gt;&lt;/ion-icon&gt;</span>
      <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/ion-buttons&gt;</span>
  <span class="nt">&lt;/ion-toolbar&gt;</span>
<span class="nt">&lt;/ion-footer&gt;</span>
</code></pre>
</div>
<p>จาก Code ข้างบนจะมีจุดสังเกตุ 3 จุดดังนี้
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ion-card</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let msg of massage"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ion-card-content&gt;</span>
      {{ msg }}
    <span class="nt">&lt;/ion-card-content&gt;</span>
<span class="nt">&lt;/ion-card&gt;</span>
</code></pre>
</div>
<p>*ngFor=”…” คือการสั่งให้วนลูปของ Angular2 ส่วน {{ msg }} คือการแสดงค่า Object ของ Angular2 หรือเรียกว่า Two-way binding (จะไว้อธิบายในบทความต่อๆไปนะครับ) และส่วนสุดท้าย (click)=”send()” คือการควบคุม event click นะครับถ้าเป็น Javascript ธรรมดาก็อารมณ์ Onclick ประมาณนั้น
รันจากนั้นเมื่อทดสอบรันด้วยคำสั่ง &lt;pre&gt;ionic serve&lt;/pre&gt; ionic จะทำการเปิด Browser ขึ้นมาและจะได้หน้าตาเปล่าๆ ประมาณนี้นะครับ
<img src="/img/ionic-chat/img02.png" alt="ทดสอบรันแอพ" />
<span class="caption text-muted">ทดสอบรันแอพผ่าน Browser</span>
ต่อมาให้เราเปิดไฟล์ Page/home/home.ts ขึ้นมาและแก้ไขให้เป็นดังนี้นะครับ
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">NavController</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ionic-angular'</span><span class="p">;</span>

<span class="nx">declare</span> <span class="kd">var</span> <span class="nx">io</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'page-home'</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'home.html'</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">HomePage</span> <span class="p">{</span>

  <span class="nl">socketHost</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">socket</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="nl">massage</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="nl">msg</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="kr">public</span> <span class="nx">navCtrl</span><span class="err">:</span> <span class="nx">NavController</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">socketHost</span> <span class="o">=</span> <span class="s2">"http://localhost:5555"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">massage</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">socketHost</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"msg"</span><span class="p">,</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">massage</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">send</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"msg"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre>
</div>
<p>อธิบาย Code นะครับ
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">declare</span> <span class="kd">var</span> <span class="nx">io</span><span class="p">;</span>
</code></pre>
</div>
<p>คือการประกาศตัวแปร io นะครับจริงๆไม่ต้องประกาศก็ได้แต่ตัว Typescript ไม่รู้จัก io เลยต้องประกาศไม่งั้นจะงอแงเอา
<div class="language-js highlighter-rouge"><pre class="highlight"><code>  <span class="nx">socketHost</span><span class="err">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">socket</span><span class="p">:</span> <span class="nl">any</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>
  <span class="nl">massage</span><span class="p">:</span> <span class="nx">string</span><span class="p">[];</span>
  <span class="nl">msg</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
</code></pre>
</div>
<p>ประกาศตัวแปลสำหรับเก็บค่าต่างๆ นะครับ
<ul>
<li>socketHost เป็น string เก็บ url ของ server
<li>socket สำหรับเก็บ socket นะครับไม่รู้จะให้ type อะไรเลยใส่เป็น any (any คือท่าไม้ตายคิด type ไม่ออก any ไปก่อน 555)
<li>massage สำหรับเก็บข้อความที่ chat ไปมาเป็น string array
<li>msg สำหรับเก็บข้อความจากช่อง input เป็น string
</ul>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">socketHost</span> <span class="o">=</span> <span class="s2">"http://localhost:5555"</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">massage</span> <span class="o">=</span> <span class="p">[];</span>
</code></pre>
</div>
<p>กำหนดค่าสำหรับตัวแปลต่างๆ
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">socketHost</span><span class="p">);</span>
</code></pre>
</div>
<p>สร้าง socket ขึ้นมา
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"msg"</span><span class="p">,</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">massage</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>
<p>เมื่อได้รับข้อความจาก server ผ่านทางท่อ msg ให้ push ใส่ array massage
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">send</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"msg"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre>
</div>
<p>ส่งข้อความไปให้ server ผ่านทางท่อ msg แค่นี้เหลาะครับเสร็จแล้วหลังจากนั้นลองดูที่ terminal ที่รัน server ของเราถ้าขึ้นว่า Client connected… ดังภาพเป็นอันเรียบร้อยโรงเรียนเตรียม 
<img src="/img/ionic-chat/img03.png" alt="แอพเสร็จแล้ว" />
<span class="caption text-muted">มีการเชื่อมต่อจาก client สู่ server</span>
ลองเปิด Browser ไปที่ <a href="http://localhost:8100/" target="_blank">http://localhost:8100</a> 2 หน้าต่างและทดสอบใช้จะได้ผลลัพท์ดังภาพ
<img src="/img/ionic-chat/img04.gif" alt="ทดสอบเล่นแอพ" />
<span class="caption text-muted">แชทได้แล้วจ้า</span>
สำหรับใครที่ต้องการทดสอบบน emulator ให้เปิด geanymotion และเปลี่ยน socketHost ไป ip เครื่องตัวเองเช่น
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">socketHost</span> <span class="o">=</span> <span class="s2">"192.168.1.28:5555"</span><span class="p">;</span>
</code></pre>
</div>
<p>และทดสอบรันด้วยคำสั่งข้างล่างนี้ก็เป็นเรียบร้อย<pre>
ionic platform add android
ionic run android
</pre>
<h1 id="conclusion">Conclusion</h1>
<p>ศึกษาเพิ่มเติม
<ul>
   <li><a href="https://ionicframework.com/" target="_blank">Ionic2</a>
   <li><a href="https://socket.io/" target="_blank">socket.io</a>
</ul>
<p>สำหรับ Code บน git แปะไว้ก่อนนะครับเพราะตอนที่เขียนบทความนี้ดึกมากแล้วง่วงมักๆ ถ้าไม่ลืมจะตามมาอัพให้นะครับ
</article>
<aside class="related">
<h2>Related posts</h2>
<ul class="related-posts">
   <li>
    <a href="/posts/angular-n-bootstrap-ep-01">
        <span>Programming 101 - Angular 'n Bootstrap EP. 01</span>
        <small>21/02</small>
    </a>
   <li>
    <a href="/posts/seneca-nodejs-microservice">
        <span>เขียน Microservice ด้วย Node.js และ Seneca.js</span>
        <small>18/01</small>
    </a>
   <li>
    <a href="/posts/loopback-nodejs-framework">
        <span>เขียน RESTful API ใน Node.js แบบ 'โคตรไว' ด้วย Loopback</span>
        <small>04/12</small>
    </a>
   <li>
    <a href="/posts/knex-nodejs-orm">
        <span>วิธีใช้ knex.js จัดการฐานข้อมูล MySQL ใน Node.js</span>
        <small>29/11</small>
    </a>
</aside>
           <footer>
    <span>This is my codex, One day I will die but my code will be forever.
</span>
    <span>written by Freeweed</span>
</footer>
       </div>
<script type="text/javascript" src="/assets/js/theme.js"></script>
<script type="text/javascript" src="/assets/js/barefoot.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-93921891-1', 'auto');
      ga('send', 'pageview');
    </script>
    
